## 合并多个样本的定量结果成一个大矩阵 (profile matrix)

https://mp.weixin.qq.com/s/laQtJl8LeyxA4BGjr-HewA

在`RNAseq`或者`metagenome shotgun`中，需要对每个样本进行逐一定量，生成每个样本各种的定量结果，然后需要合并每个样本的定量结果，形成一个包含所有样本定量的`profile matrix`

我们这个脚本的要实现的就是合并多个样本的定量结果成一个大矩阵 `(profile matrix)`

```R
loadMatrix <- function(dir,pattern){
files <- list.files(dir)
clones <- vector()    # 用于保存所有样本中出现的克隆
samples <- vector()    # 用于保存所有样本的id
# 获取所有样本中出现的unique克隆，与所有样本的id
for (file in files) {
    if (grepl(pattern,file)){
        data <- read.table(paste(dir,file,sep="/"),header=F,sep="\t")
        clones <- c(clones,as.character(data$V1))
        samples <- c(samples,sub(pattern,"",file))
    }
}
# 创建用于保存所有样本整合的表达谱，以0填充
clones <- unique(clones)
dataMat <- matrix(rep(0,length(samples)*length(clones)),nrow = length(clones),ncol = length(samples))
rownames(dataMat) <- clones
colnames(dataMat) <- samples
# 逐一读入样本的count文件，对matrix中对应的元素进行赋值
for (file in files) {
    if (grepl(pattern,file)){
        data <- read.table(paste(dir,file,sep="/"),header=F,sep="\t")
        sample <- as.character(sub(pattern,"",file))
        index <- match(data$V1,rownames(dataMat))
        dataMat[index,sample] <- data$V2
    }
}
dataMat
}
```

